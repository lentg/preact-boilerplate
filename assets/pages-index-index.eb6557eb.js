import{i as t,s as e,a as n,o as a,b as i,p as o,c as s,d as l,h as c,e as r,f as d,w as u,r as h,g as p,j as g,k as f,l as m,t as y,m as _,n as C,F as v,q as w,u as b,v as S}from"./index.ad3e953e.js";var D={en:{"uniCloud.component.add.success":"Success","uniCloud.component.update.success":"Success","uniCloud.component.remove.showModal.title":"Tips","uniCloud.component.remove.showModal.content":"是否删除该数据"},es:{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否删除该数据"},fr:{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否删除该数据"},"zh-Hans":{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否删除该数据"},"zh-Hant":{"uniCloud.component.add.success":"新增成功","uniCloud.component.update.success":"修改成功","uniCloud.component.remove.showModal.title":"提示","uniCloud.component.remove.showModal.content":"是否刪除數據"}},I=(t,e)=>{const n=t.__vccOpts||t;for(const[a,i]of e)n[a]=i;return n};const L=Array.isArray,{t:x}=t(D),M="load",E="error",T="add",z="replace",F="auto",k="manual",O=["pageCurrent","pageSize","collection","action","field","getcount","orderby","where","groupby","groupField","distinct"];var j=I({name:"UniClouddb",setup(t){const i=t.ssrKey?t.getone?e(void 0,t.ssrKey):n([],t.ssrKey):t.getone?e(void 0,"piNqzCm/3JmXIfAWPyuiDw=="):n([],"9WGRudttKJ1o38sNQJmC7g=="),o=p();return a((()=>{i.value&&0!==i.value.length||t.manual||t.loadtime!==F||o.proxy.loadData()})),{dataList:i}},async serverPrefetch(){if(!this.manual&&this.loadtime===F)return this.loadData()},props:{options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},getone:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String,Object],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},pageIndistinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1},ssrKey:{type:[String,Number],default:""}},data:()=>({loading:!1,hasMore:!1,paginationInternal:{},errorMessage:""}),computed:{collectionArgs(){return L(this.collection)?this.collection:[this.collection]},isLookup(){return L(this.collection)&&this.collection.length>1||"string"==typeof this.collection&&this.collection.indexOf(",")>-1},mainCollection(){if("string"==typeof this.collection)return this.collection.split(",")[0];return JSON.parse(JSON.stringify(this.collection[0])).$db[0].$param[0]}},created(){this._isEnded=!1,this.paginationInternal={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((()=>{var t=[];return O.forEach((e=>{t.push(this[e])})),t}),((t,e)=>{if(this.paginationInternal.size=this.pageSize,t[0]!==e[0]&&(this.paginationInternal.current=this.pageCurrent),this.loadtime===k)return;let n=!1;for(let a=2;a<t.length;a++)if(t[a]!==e[a]){n=!0;break}n&&(this.clear(),this.reset()),this._execLoadData()}))},methods:{loadData(t,e){let n=null,a=!1;return"object"==typeof t?(t.clear&&(this.pageData===z?this.clear():a=t.clear,this.reset()),void 0!==t.current&&(this.paginationInternal.current=t.current),"function"==typeof e&&(n=e)):"function"==typeof t&&(n=t),this._execLoadData(n,a)},loadMore(){this._isEnded||this.loading||(this.pageData===T&&this.paginationInternal.current++,this._execLoadData())},refresh(){this.clear(),this._execLoadData()},clear(){this._isEnded=!1,this.dataList=[]},reset(){this.paginationInternal.current=1},add(t,{action:e,showToast:n=!0,toastTitle:a,success:r,fail:d,complete:u,needConfirm:h=!0,needLoading:p=!0,loadingTitle:g=""}={}){p&&i({title:g});let f=o.database(this.spaceInfo);e&&(f=f.action(e)),f.collection(this.mainCollection).add(t).then((t=>{r&&r(t),n&&s({title:a||x("uniCloud.component.add.success")})})).catch((t=>{d&&d(t),h&&l({content:t.message,showCancel:!1})})).finally((()=>{p&&c(),u&&u()}))},remove(t,{action:e,success:n,fail:a,complete:i,confirmTitle:o,confirmContent:s,needConfirm:c=!0,needLoading:r=!0,loadingTitle:d=""}={}){t&&t.length&&(c?l({title:o||x("uniCloud.component.remove.showModal.title"),content:s||x("uniCloud.component.remove.showModal.content"),showCancel:!0,success:o=>{o.confirm&&this._execRemove(t,e,n,a,i,c,r,d)}}):this._execRemove(t,e,n,a,i,c,r,d))},update(t,e,{action:n,showToast:a=!0,toastTitle:r,success:d,fail:u,complete:h,needConfirm:p=!0,needLoading:g=!0,loadingTitle:f=""}={}){g&&i({title:f});let m=o.database(this.spaceInfo);return n&&(m=m.action(n)),m.collection(this.mainCollection).doc(t).update(e).then((t=>{d&&d(t),a&&s({title:r||x("uniCloud.component.update.success")})})).catch((t=>{u&&u(t),p&&l({content:t.message,showCancel:!1})})).finally((()=>{g&&c(),h&&h()}))},getTemp(t=!0){let e=o.database(this.spaceInfo);this.action&&(e=e.action(this.action)),e=e.collection(...this.collectionArgs),this.foreignKey&&(e=e.foreignKey(this.foreignKey)),this.where&&Object.keys(this.where).length&&(e=e.where(this.where)),this.field&&(e=e.field(this.field)),this.groupby&&(e=e.groupBy(this.groupby)),this.groupField&&(e=e.groupField(this.groupField)),!0===this.distinct&&(e=e.distinct()),this.orderby&&(e=e.orderBy(this.orderby));const{current:n,size:a}=this.paginationInternal,i={};this.getcount&&(i.getCount=this.getcount);const s={limitLevel:this.limitlevel,startWith:this.startwith};return this.gettree&&(i.getTree=s),this.gettreepath&&(i.getTreePath=s),e=e.skip(a*(n-1)).limit(a),t?(e=e.getTemp(i),e.udb=this):e=e.get(i),e},setResult(t){0===t.code?this._execLoadDataSuccess(t):this._execLoadDataFail(new Error(t.message))},_execLoadData(t,e){if(!this.loading)return this.loading=!0,this.errorMessage="",this._getExec().then((n=>{this.loading=!1,this._execLoadDataSuccess(n.result,t,e)})).catch((e=>{this.loading=!1,this._execLoadDataFail(e,t)}))},_execLoadDataSuccess(t,e,n){const{data:a,count:i}=t;this._isEnded=void 0!==i?this.paginationInternal.current*this.paginationInternal.size>=i:a.length<this.pageSize,this.hasMore=!this._isEnded;const o=this.getone?a.length?a[0]:void 0:a;this.getcount&&(this.paginationInternal.count=i),e&&e(o,this._isEnded,this.paginationInternal),this._dispatchEvent(M,o),this.getone||this.pageData===z||n?this.dataList=o:this.dataList.push(...o)},_execLoadDataFail(t,e){this.errorMessage=t,e&&e(),this.$emit(E,t)},_getExec(){return this.getTemp(!1)},_execRemove(t,e,n,a,s,r,d,u){if(!this.collection||!t)return;const h=L(t)?t:[t];if(!h.length)return;d&&i({mask:!0,title:u});const p=o.database(this.spaceInfo),g=p.command;let f=p;e&&(f=f.action(e)),f.collection(this.mainCollection).where({_id:g.in(h)}).remove().then((t=>{n&&n(t.result),this.pageData===z?this.refresh():this.removeData(h)})).catch((t=>{a&&a(t),r&&l({content:t.message,showCancel:!1})})).finally((()=>{d&&c(),s&&s()}))},removeData(t){const e=t.slice(0),n=this.dataList;for(let a=n.length-1;a>=0;a--){const t=e.indexOf(n[a]._id);t>=0&&(n.splice(a,1),e.splice(t,1))}},_dispatchEvent(t,e){this._changeDataFunction?this._changeDataFunction(e,this._isEnded,this.paginationInternal):this.$emit(t,e,this._isEnded,this.paginationInternal)}}},[["render",function(t,e,n,a,i,o){const s=g;return r(),d(s,null,{default:u((()=>[h(t.$slots,"default",{options:n.options,data:a.dataList,pagination:i.paginationInternal,loading:i.loading,hasMore:i.hasMore,error:i.errorMessage})])),_:3})}]]);var B=I({data:()=>({title:"Hello"}),onLoad(){},methods:{}},[["render",function(t,e,n,a,i,o){const s=g,l=w(b("unicloud-db"),j),c=S;return r(),d(s,{class:"content bg-_wn_f58",bg:"#f58"},{default:u((()=>[f(s,{class:"bg-gradient-to-lt from-_wn_f39c12_sl_60 via-_wn_fff_cl_80 to-_wn_9b59b6_70 h-auto w-full"},{default:u((()=>[f(l,{"page-size":500,orderby:"at desc",collection:"yifus"},{default:u((({data:t,loading:e,error:n,options:a})=>[n?(r(),d(s,{key:0},{default:u((()=>[m(y(n.message),1)])),_:2},1024)):(r(),d(s,{key:1,class:"v-else"},{default:u((()=>[(r(!0),_(v,null,C(t,((t,e)=>(r(),d(s,{key:e},{default:u((()=>[m(y(t.jdh)+" - "+y(t.kh)+" - : "+y(t.cs),1)])),_:2},1024)))),128))])),_:2},1024))])),_:1})])),_:1}),f(s,{class:"text-area"},{default:u((()=>[f(c,{class:"title p-10 bg-_wn_333",p:"10",bg:"#333"},{default:u((()=>[m(y(i.title),1)])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-0a75a929"]]);export{B as default};
